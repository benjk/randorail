---
import content from '../data/content.json';
import './announcement.scss';
import { blocRules } from '../admin/data/blocRules';

const { isVisible = true } = Astro.props;
const { sourceBlocKey, blocIndex } = content.home.announcement;
const blocRule = blocRules[sourceBlocKey];

if (!blocRule) {
  throw new Error(`Bloc rule not found for key: ${sourceBlocKey}`);
}

const jsonPath = blocRule.jsonKey.split('.');
let blocData: any = content;
for (const part of jsonPath) {
  if (!blocData) break;
  blocData = blocData[part];
}

const announcement = blocData?.items?.[blocIndex];

if (!announcement) {
  throw new Error(`Announcement not found at index ${blocIndex}`);
}

const { title } = announcement;
---

<div
class:list={['announcement-banner', { 'is-visible': isVisible }]}  role="button"
  tabindex="0"
  aria-label="Ouvrir l'annonce"
>
  <svg class="banner-icon">
    <use href="#picto-info"></use>
  </svg>
  <span class="banner-title">{title}</span>
</div>

---
import HighlightOnHash from '../components/Highlight';
import MainLayout from './MainLayout.astro';
import '../styles/activity_page.scss';
import '../styles/pages.scss';
import type { ActivityFull, FAQItem } from '../data/activities-type';
import { Image } from 'astro:assets';
import FaqList from '../components/FaqList.astro';
import CardsGrid from '../components/CardsGrid.astro';
import content from '../data/content.json';
import { formatFrenchPhone } from '../utils/utils';
const { href } = formatFrenchPhone(content.contact.tel);

interface Props extends ActivityFull {
  faq: FAQItem[];
  fullSlug: string;
}

const {
  docTitle,
  title,
  image1,
  mainText = [],
  tarifs = [],
  horaires = [],
  url,
  image2,
  secondaryText = [],
  icon,
  faq = [],
  fullSlug,
} = Astro.props;

const isFilet = fullSlug.includes('filets');
---

<MainLayout title={docTitle}>
  <div class="content-container">
    <div class="activity-page-layout">
      <section class="activity-main-info-container activity-page-section">
        {
          image1 && (
            <div class="activity-main-img">
              <Image
                src={image1}
                alt={`Photo de l'activité ${title}`}
                width={1200}
                height={800}
                loading="eager"
              />
            </div>
          )
        }

        <div class="activity-text-card">
          <h1>{title}</h1>
          <div class="p-container">
            {mainText.map((paragraph) => <p>{paragraph}</p>)}
          </div>

          {
            !isFilet && (
              <div class="reserve-btn-container">
                {url ? (
                  <>
                    <a
                      class="reserve-btn"
                      href={url}
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      <svg class="btn-icon">
                        <use href={`#${icon}`} />
                      </svg>
                      Réserver
                    </a>
                    <p class="reservation-info">
                      Pour toute réservation pour le jour même,{' '}
                      <a href={`tel:${href}`} class="inline-link">
                        appelez nous directement
                      </a>
                    </p>
                  </>
                ) : (
                  <a class="reserve-btn" href="/contact">
                    <svg class="btn-icon">
                      <use href={`#${icon}`} />
                    </svg>
                    Réserver
                  </a>
                )}
              </div>
            )
          }
        </div>
      </section>

      <!-- Tarifs + Horaires sur 2 colonnes -->
      {
        horaires.length > 0 && tarifs.length && (
          <section class="activity-info-practical activity-page-section">
            <h2>Tarifs & Horaires</h2>
            <div class="practical-wrapper">
              {tarifs.length > 0 && (
                <div class="tarifs-section practical-info-card">
                  <div class="tarifs-grid">
                    {tarifs.map((t) => (
                      <div class="tarif-item">
                        <strong>{t.label}</strong>
                        <span>{t.value}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}
              <hr />

              {horaires.length > 0 && (
                <div class="horaires-section practical-info-card">
                  <div class="horaire-container">
                    {horaires.map((h) => (
                      <div class="horaire-item">
                        <strong>{h.label}</strong>
                        <span>{h.value}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </section>
        )
      }

      <!-- SI JAI BESOIN : Slot pour contenu custom AVANT le contenu secondaire par défaut -->
      <slot name="secondary-slot" />

      <!-- Image secondaire -->
      {
        image2 && (
          <section class="activity-secondary-image">
            <Image
              src={image2}
              alt={`Photo de l'activité ${title}`}
              width={1800}
              height={600}
              loading="lazy"
            />
          </section>
        )
      }

      <!-- Texte secondaire -->
      {
        secondaryText.length > 0 && (
          <section class="activity-secondary">
            {secondaryText.map((paragraph) => (
              <p>{paragraph}</p>
            ))}
          </section>
        )
      }

      <div class="other-activities-wrapper">
        <h2>Explorez nos activités</h2>
        <div class="activities-container">
          <CardsGrid exclude={[fullSlug]} />
        </div>
      </div>

      <section class="full-wrapper">
        <div class="faq-wrapper full-content">
          <FaqList items={faq} />
        </div>
      </section>

      <section class="page-bottom-image">
        <Image
          src="/img/activities/rando-frise.webp"
          alt={`Photo du site du rando-rail`}
          width={1800}
          height={600}
          loading="lazy"
        />
      </section>
    </div>
  </div>
  <HighlightOnHash client:load />
</MainLayout>

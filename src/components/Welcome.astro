---
import content from '../data/content.json';
import { VIDEO_HERO_URL } from '../config';
import HighlightOnHash from './Highlight';
import { imageWithHash } from '../admin/components/images/imageWithHash';
import { blocRules } from '../admin/data/blocRules';
import ActivityCard from '../components/ActivityCard.astro';
import { activitiesWithMeta } from '../data/activities';
---

<div id="home-container" class="content-container">
  {
    content.home.announcement?.enabled &&
      (() => {
        const { sourceBlocKey, blocIndex } = content.home.announcement;
        const blocRule = blocRules[sourceBlocKey];
        if (!blocRule) return null;

        const jsonPath = blocRule.jsonKey.split('.');
        let blocData: any = content;
        for (const part of jsonPath) {
          if (!blocData) break;
          blocData = blocData[part];
        }

        const item = blocData?.items?.[blocIndex];
        if (!item) return null;

        const firstImageField = Object.values(
          blocRules[sourceBlocKey].imageFields || {},
        )[0];
        const folder = firstImageField?.folder || '';

        return (
          <section id="announcement" class="announcement-section">
            <div
              class="announcement-wrapper"
              style={`background-image: url('${imageWithHash(item.imgName, folder)}')`}
            >
              <div class="announcement-content">
                <h3 class="announcement-title">{item.title}</h3>
                <p class="announcement-text">{item.content}</p>
              </div>
            </div>
          </section>
        );
      })()
  }

  <!-- SECTION 1 : VIDEO (fond) -->
  <section class="video-wrapper">
    <div class="video-section">
      <video autoplay muted loop playsinline webkit-playsinline class="video-bg">
        <source src={`${VIDEO_HERO_URL}`} type="video/webm" />
      </video>
    </div>
  </section>

  <!-- SECTION 2 : ACTIVITIES -->
  <section class="activities-section">
    <div class="title-container">
      <h3 class="main-title main-content">Le Randorail</h3>
      <h3 class="main-title">du pays de Lumbres</h3>
    </div>
    <div class="activities-container">
      <!-- <h3 class="activities-title">Nos activités</h3> -->
      <div class="cards-grid">
        {
          activitiesWithMeta.map((activity) => (
            <ActivityCard
              bgImage={activity.bgImage}
              icon={activity.icon}
              title={activity.title}
              slug={activity.slug}
            />
          ))
        }
      </div>
    </div>
  </section>

  <!-- SECTION 3 : VIDEO OVERLAY -->
  <section class="video-section-overlay">
    <img class="video-icon" src="/img/icons/icon-video.svg" alt="">
  </section>
  
  <!-- SECTION 4 : WHATEVER CE QUON VEUT FOUTRE -->
  <section class="third-section">
    <h3>ICI Je mettrais bien un petit mot sur les évènements, : Anniversaires, EVG, EVJF, Team building, blabla</h3>
    <br>
    <br>
    <h3>Et ensuite quelques chiffres : X visiteurs par ans, 20 ans d'expériences, Activités répartis sur X hecatre de forêts,...</h3>
  </section>
</div>

<HighlightOnHash client:load />

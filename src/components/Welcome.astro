---
import content from '../data/content.json';
import { VIDEO_HERO_URL } from '../config';
import HighlightOnHash from './Highlight';
import { imageWithHash } from '../admin/components/images/imageWithHash';
import { blocRules } from '../admin/data/blocRules';
import CardsGrid from './CardsGrid.astro';
import RailSVG from './RailSVG.astro';
---

<div id="home-container" class="content-container">
  {
    content.home.announcement?.enabled &&
      (() => {
        const { sourceBlocKey, blocIndex } = content.home.announcement;
        const blocRule = blocRules[sourceBlocKey];
        if (!blocRule) return null;

        const jsonPath = blocRule.jsonKey.split('.');
        let blocData: any = content;
        for (const part of jsonPath) {
          if (!blocData) break;
          blocData = blocData[part];
        }

        const item = blocData?.items?.[blocIndex];
        if (!item) return null;

        const firstImageField = Object.values(
          blocRules[sourceBlocKey].imageFields || {},
        )[0];
        const folder = firstImageField?.folder || '';

        return (
          <section id="announcement" class="announcement-section">
            <div
              class="announcement-wrapper"
              style={`background-image: url('${imageWithHash(item.imgName, folder)}')`}
            >
              <div class="announcement-content">
                <h3 class="announcement-title">{item.title}</h3>
                <p class="announcement-text">{item.content}</p>
              </div>
            </div>
          </section>
        );
      })()
  }

  <!-- SECTION VIDEO (fond) -->
  <section class="video-wrapper">
    <div class="video-section">
      <video
        autoplay
        muted
        loop
        playsinline
        webkit-playsinline
        class="video-bg"
      >
        <source src={`${VIDEO_HERO_URL}`} type="video/webm" />
      </video>
    </div>
  </section>

  <!-- SECTION 1 : ACTIVITIES -->
  <section class="section1">
    <div class="title-container">
      <h1 class="main-title main-content">Safari Rail Aventure</h1>
      <h3 class="main-title">Nielles-lès-Bléquin</h3>
    </div>
    <div class="rail-wrapper">
      <RailSVG />
    </div>
    <div class="activities-container">
      <CardsGrid />
    </div>
  </section>
  <!-- SECTION 4 : WHATEVER CE QUON VEUT FOUTRE -->
  <section class="section2">
    <div class="section-wrapper">
      <!-- <h2>J'organise ma venue</h2> -->
      <h3>Votre visite, sans prise de tête</h3>
      <hr class="main-hr" />
      <div class="content-wrapper">
        <!-- Bloc : 2 carrés côte à côte -->
        <div class="cards-row">
          <!-- Carré 1 : Infos spécifiques -->
          <div class="info-card">
            <p>Besoin d'infos ?</p>
            <div class="infos-wrapper">
              <a href="/activites" class="card-link">
                <div
                  class="info-icon"
                  style={{
                    mask: "url('/img/icons/picto-rail.svg') no-repeat center / contain",
                    WebkitMask:
                      "url('/img/icons/picto-rail.svg') no-repeat center / contain",
                  }}
                >
                </div>
                <span>Horaires & Tarifs des activités</span>
              </a>
              <a href="/restauration" class="card-link">
                <div
                  class="info-icon"
                  style={{
                    mask: "url('/img/icons/picto-food.svg') no-repeat center / contain",
                    WebkitMask:
                      "url('/img/icons/picto-food.svg') no-repeat center / contain",
                  }}
                >
                </div>
                <span>Restauration sur place</span>
              </a>
            </div>
          </div>

          <!-- Carré 2 : Groupes -->
          <div class="info-card">
            <div
              class="info-icon"
              style={{
                mask: "url('/img/icons/picto-groupe.svg') no-repeat center / contain",
                WebkitMask:
                  "url('/img/icons/picto-groupe.svg') no-repeat center / contain",
              }}
            >
            </div>
            <p>Je veux venir en groupe</p>
            <a href="/groupes" class="card-link"
              ><span>Comment ça marche ?</span></a
            >
          </div>
        </div>
        <!-- Bloc : Comment s'y rendre (large) -->
        <div class="goto-wrapper">
          <div class="text-wrapper">
            <a
              target="_blank"
              href="https://maps.app.goo.gl/qwV6SX6nNrjvzCq18"
              class="inline-link"
            >
              <div
                class="info-icon"
                style={{
                  mask: "url('/img/icons/picto-pin.svg') no-repeat center / contain",
                  WebkitMask:
                    "url('/img/icons/picto-pin.svg') no-repeat center / contain",
                }}
              >
              </div>
              Itinéraire
            </a>
            <div class="address-card">
              <address>
                <p>{content.contact.street}</p>
                <p>{content.contact.postalCode} {content.contact.city}</p>
              </address>
            </div>
          </div>
          <img
            src="/img/static/goto-img.jpg"
            alt="Plan d'accès Safari Rail Aventure"
          />
        </div>

        <!-- Bloc 3 : CTA final -->
        <div class="contact-wrapper">
          <div class="p-wrapper">
            <p class="contact-text">
              Vous ne trouvez pas l'information que vous cherchez ?
            </p>
            <p class="contact-text">
              N'hésitez pas à nous contacter directement !
            </p>
          </div>
          <a href="/contact" class="info-btn">J'ai des questions</a>
        </div>
      </div>
    </div>
  </section>
  <section class="section3">
    <p>
      Et ensuite quelques chiffres : X visiteurs par ans, 20 ans d'expériences,
      Activités répartis sur X hecatre de forêts,...
    </p>
    <br />
    <p>
      Puis on peut imaginer d'autres infos : les partenaires, promotions de bons
      cadeaux ou tout ce que tu désire mettre en avant sur la HomePage
    </p>
  </section>
  <!-- SECTION 3 : VIDEO OVERLAY -->
  <section class="video-section-overlay">
    <img
      class="video-icon"
      src="/img/icons/icon-video.svg"
      alt="Le Randorail en images"
    />
  </section>
  <section class="section4">
    <p>BIENTÔT NOUVELLE ACTIVITE ! Le parc de Filets !!</p>
    <p>Imaginons un beau Visuel</p>
  </section>
  <section class="section5">
    <div class="content-wrapper">
      <div class="img-wrapper">
        <img
          src="/img/groups_img.webp"
          alt="Célébration en famille au Randorail"
        />
      </div>
      <div class="text-wrapper">
        <h3>Anniversaires, EVG/EVJF, fêtes de familles</h3>
        <h2>Venez fêter ça avec nous !</h2>
        <div class="p-wrapper">
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
            eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim
            ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut.
          </p>
          <p>
            aliquip ex ea commodo consequat. Duis aute irure dolor in
            reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
            pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
            culpa qui officia deserunt mollit anim id est laborum.
          </p>
        </div>
        <a href="/contact" class="info-btn">On s'organise</a>
      </div>
    </div>
  </section>

  <HighlightOnHash client:load />
</div>

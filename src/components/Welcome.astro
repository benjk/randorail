---
import content from '../data/content.json';
import { VIDEO_HERO_URL } from '../config';
import HighlightOnHash from './Highlight';
import { imageWithHash } from '../admin/components/images/imageWithHash';
import { imageRules } from '../admin/data/imageRules';
import { blocRules } from '../admin/data/blocRules';
---

<div id="home-container" class="content-container">
  {
    content.home.announcement?.enabled &&
      (() => {
        const { sourceBlocKey, blocIndex } = content.home.announcement;
        const blocRule = blocRules[sourceBlocKey];
        if (!blocRule) return null;

        const jsonPath = blocRule.jsonKey.split('.');
        let blocData: any = content;
        for (const part of jsonPath) {
          if (!blocData) break;
          blocData = blocData[part];
        }

        const item = blocData?.items?.[blocIndex];
        if (!item) return null;

        const firstImageField = Object.values(
          blocRules[sourceBlocKey].imageFields || {},
        )[0];
        const folder = firstImageField?.folder || '';

        return (
          <section id="announcement" class="announcement-section">
            <div
              class="announcement-wrapper"
              style={`background-image: url('${imageWithHash(item.imgName, folder)}')`}
            >
              <div class="announcement-content">
                <h3 class="announcement-title">{item.title}</h3>
                <p class="announcement-text">{item.content}</p>
              </div>
            </div>
          </section>
        );
      })()
  }
  <section class="second-section">
    <div class="side-fb-container">
      <video autoplay muted loop playsinline style="width:100%;height:auto;">
        <source src=`${VIDEO_HERO_URL}` type="video/webm" />
      </video>
      <p id="intro-text1" class="p2 p3">{content.home.secondSection.text1}</p>
      <p id="intro-text2" class="p2 p3">{content.home.secondSection.text2}</p>
      <p id="intro-text3" class="p2 p3">{content.home.secondSection.text3}</p>
    </div>
  </section>
</div>
<HighlightOnHash client:load />
